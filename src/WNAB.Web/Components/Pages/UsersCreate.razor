@page "/users/create"
@inject UserManagementService UsersService

<h1>Create User</h1>

<EditForm Model="this" OnValidSubmit="Create">
    <div class="row g-3 responsive-panel">
        <div class="col-12 col-md-4">
            <label class="form-label">First Name</label>
            <input class="form-control" @bind-value="_firstName" required />
        </div>
        <div class="col-12 col-md-4">
            <label class="form-label">Last Name</label>
            <input class="form-control" @bind-value="_lastName" required />
        </div>
        <div class="col-12 col-md-4">
            <label class="form-label">Email</label>
            <input class="form-control" type="email" @bind-value="_email" required />
        </div>
        <div class="col-12">
            <button class="btn btn-primary" type="submit">Create</button>
        </div>
    </div>
    
</EditForm>

@if (!string.IsNullOrWhiteSpace(_result))
{
    <pre class="mt-3">@_result</pre>
}
@if (!string.IsNullOrWhiteSpace(_error))
{
    <div class="alert alert-danger mt-3">@_error</div>
}

@code {
    private string? _firstName;
    private string? _lastName;
    private string? _email;
    private string? _result;
    private string? _error;

    private async Task Create()
    {
        _result = _error = null;
        try
        {
            // LLM-Dev (touched): Use service to create DTO and POST to API.
            var record = UserManagementService.CreateUserRecord(_firstName ?? string.Empty, _lastName ?? string.Empty, _email ?? string.Empty);
            var id = await UsersService.CreateUserAsync(record);
            _result = $"Created user with Id {id}";
        }
        catch (Exception ex)
        {
            _error = ex.Message;
        }
    }
}
