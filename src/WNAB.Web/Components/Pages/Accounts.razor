@page "/accounts"
@inject IHttpClientFactory ClientFactory

<h1>Accounts</h1>

<div class="mb-3">
    <label>User Id</label>
    <input class="form-control" type="number" @bind-value="_userId" />
</div>
<button class="btn btn-secondary" @onclick="Load">Load Accounts</button>

@if (_error is not null)
{
    <div class="alert alert-danger mt-3">@_error</div>
}

@if (_json is null)
{
    <p class="mt-3"><em>No data yet.</em></p>
}
else
{
    <pre class="mt-3">@_json</pre>
}

@code {
    private int _userId;
    private string? _json;
    private string? _error;

    private async Task Load()
    {
        _error = null;
        try
        {
            var client = ClientFactory.CreateClient("wnab-api");
            using var resp = await client.GetAsync($"/users/accounts?userId={_userId}");
            _json = await resp.Content.ReadAsStringAsync();
        }
        catch (Exception ex)
        {
            _error = ex.Message;
        }
    }
}
